<!doctype html>
<html class="no-js" lang="">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Logic Analyzer</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/gui.css">
    <script src="./js/two.js"></script>
  </head>
  <body>
    <button id="openFile" onclick="openFile();">Open</button>

    <div class="channels">
      <div class="channel" id="channel_00">

      </div>
    </div>

    <script>
      var remote = require('remote');
      var dialog = remote.require('dialog');
      var fs = require('fs');
      var csv = require('csv');
      var LOW = false;
      var HIGH = true;
      var openDialogOptions = {
        filters: [
          {
            name: 'csv',
            extensions: ['csv']
          }
        ]
      }

      function openFile () {
        dialog.showOpenDialog(openDialogOptions, function (fileNames) {
          if (fileNames === undefined) return;
          var fileName = fileNames[0];
          fs.readFile(fileName, 'utf-8', function (err, data) {
            csv.parse(data, function(err, data) {
              data.forEach(function(row, index) {
                var timestamp = parseFloat(row[0]);
                var value = row[1].replace(/ /g,'') == "0" ? HIGH : LOW;

                console.log(timestamp, value);
              })
            })
          });
        });
      }


      var elem = document.getElementById("channel_00");
      var params = { width: 600, height: 200 };
      var two = new Two(params).appendTo(elem);
      var starting_coordinates = [0, 10];
      var line_coordinates = [
        [10, 10],
        [10, 190],
        [50, 190],
        [50,10],
        [70,10],
        [70,190],
        [400,190]
      ];

      function drawLine(x1, y1, x2, y2) {
        return two.makeLine(x1, y1, x2, y2);
      }

      line_coordinates.forEach(function(coordinates, index) {
        var line = drawLine.apply(this, starting_coordinates.concat(coordinates));
        line.stroke = 'orangered'; // Accepts all valid css color
        line.linewidth = 2;

        // set new starting coordinates
        starting_coordinates = coordinates;
      })

      two.update();
    </script>
  </body>
</html>
